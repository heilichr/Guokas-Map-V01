<!DOCTYPE html>
<html>
<head>
  <title>Leaflet Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Leaflet Measure CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-measure@3.3.0/dist/leaflet-measure.css" />

  <style>
    #map {
      height: 100vh;
      width: 100%;
    }

    /* North Arrow */
    .leaflet-control-north {
      background-image: url('https://upload.wikimedia.org/wikipedia/commons/e/ec/Compass_rose_simple.svg');
      background-size: 50px 50px;
      width: 50px;
      height: 50px;
      opacity: 0.8;
    }
  </style>
</head>

<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Leaflet Measure JS -->
<script src="https://cdn.jsdelivr.net/npm/leaflet-measure@3.3.0/dist/leaflet-measure.min.js"></script>

<script>
// Create the map
var map = L.map('map').setView([44.18080, -89.48536], 16);

// Basemaps
var esriImagery = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { maxZoom: 19, attribution: 'Tiles © Esri' }
).addTo(map);

var osm = L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  { maxZoom: 19, attribution: '© OpenStreetMap contributors' }
);

var topo = L.tileLayer(
  'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
  { maxZoom: 17, attribution: '© OpenTopoMap' }
);

var baseMaps = {
  "ESRI Imagery": esriImagery,
  "OpenStreetMap": osm,
  "Topo Map": topo
};

// Overlay layer containers
var trailsLayer, propertyLayer, roadsLayer, pointsLayer;

// Safe style function
function styleFromProperties(feature) {
  var props = feature.properties || {};

  return {
    color: props.stroke || '#0000FF',
    weight: props['stroke-width'] || 2,
    opacity: props['stroke-opacity'] || 1,
    fillColor: props.fill || '#0000FF',
    fillOpacity: props['fill-opacity'] || 0
  };
}

// TRAILS (auto-zoom)
fetch('trails.geojson')
  .then(r => r.json())
  .then(data => {
    trailsLayer = L.geoJSON(data, { style: styleFromProperties }).addTo(map);
    map.fitBounds(trailsLayer.getBounds());
  });

// PROPERTY
fetch('property.geojson')
  .then(r => r.json())
  .then(data => {
    propertyLayer = L.geoJSON(data, { style: styleFromProperties });
  });

// ROADS
fetch('roads.geojson')
  .then(r => r.json())
  .then(data => {
    roadsLayer = L.geoJSON(data, { style: styleFromProperties });
  });

// POINTS
fetch('points.geojson')
  .then(r => r.json())
  .then(data => {
    pointsLayer = L.geoJSON(data, {
      pointToLayer: function(feature, latlng) {
        var props = feature.properties || {};

        return L.circleMarker(latlng, {
          radius: props['marker-size'] || 6,
          color: props.stroke || '#000000',
          fillColor: props.fill || '#000000',
          fillOpacity: props['fill-opacity'] || 1,
          weight: props['stroke-width'] || 2
        });
      }
    });
  });

// Layer toggle
var overlays = {
  "Trails": trailsLayer,
  "Property Boundary": propertyLayer,
  "Roads": roadsLayer,
  "Points": pointsLayer
};

L.control.layers(baseMaps, overlays, { collapsed: false }).addTo(map);

// Scale bar
L.control.scale({ position: 'bottomleft', imperial: true, metric: true }).addTo(map);

// Measurement tool
if (L.control.measure) {
  L.control.measure({
    position: 'topleft',
    primaryLengthUnit: 'feet',
    secondaryLengthUnit: 'miles',
    primaryAreaUnit: 'acres',
    secondaryAreaUnit: 'sqmeters'
  }).addTo(map);
}

// North arrow
var north = L.control({ position: "topright" });
north.onAdd = function(map) {
  var div = L.DomUtil.create("div", "leaflet-control-north");
  return div;
};
north.addTo(map);

</script>

</body>
</html>
