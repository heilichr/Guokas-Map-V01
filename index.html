<script>
// Create the map
var map = L.map('map').setView([44.18080, -89.48536], 16);

// Basemaps
var esriImagery = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { maxZoom: 19, attribution: 'Tiles © Esri' }
).addTo(map);

var osm = L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  { maxZoom: 19, attribution: '© OpenStreetMap contributors' }
);

var topo = L.tileLayer(
  'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
  { maxZoom: 17, attribution: '© OpenTopoMap' }
);

var baseMaps = {
  "ESRI Imagery": esriImagery,
  "OpenStreetMap": osm,
  "Topo Map": topo
};

// Overlay layer containers
var trailsLayer, contours3Layer, contours1100Layer, contoursWaterLayer;

// Safe style function
function styleFromProperties(feature) {
  var props = feature.properties || {};

  return {
    color: props.stroke || '#0000FF',
    weight: props['stroke-width'] || 2,
    opacity: props['stroke-opacity'] || 1,
    fillColor: props.fill || '#0000FF',
    fillOpacity: props['fill-opacity'] || 0
  };
}

// TRAILS (auto-zoom)
fetch('trails.geojson')
  .then(r => r.json())
  .then(data => {
    trailsLayer = L.geoJSON(data, { style: styleFromProperties }).addTo(map);
    map.fitBounds(trailsLayer.getBounds());
  });

// CONTOURS 3
fetch('contours3.geojson')
  .then(r => r.json())
  .then(data => {
    contours3Layer = L.geoJSON(data, { style: styleFromProperties });
  });

// CONTOURS 1100
fetch('contours1100.geojson')
  .then(r => r.json())
  .then(data => {
    contours1100Layer = L.geoJSON(data, { style: styleFromProperties });
  });

// CONTOURS WATER
fetch('contourswater.geojson')
  .then(r => r.json())
  .then(data => {
    contoursWaterLayer = L.geoJSON(data, { style: styleFromProperties });
  });

// Layer toggle
var overlays = {
  "Trails": trailsLayer,
  "Contours (3ft)": contours3Layer,
  "Contours (1100ft)": contours1100Layer,
  "Water Contours": contoursWaterLayer
};

L.control.layers(baseMaps, overlays, { collapsed: false }).addTo(map);

// Scale bar
L.control.scale({ position: 'bottomleft', imperial: true, metric: true }).addTo(map);

// Measurement tool
if (L.control.measure) {
  L.control.measure({
    position: 'topleft',
    primaryLengthUnit: 'feet',
    secondaryLengthUnit: 'miles',
    primaryAreaUnit: 'acres',
    secondaryAreaUnit: 'sqmeters'
  }).addTo(map);
}

// North arrow
var north = L.control({ position: "topright" });
north.onAdd = function(map) {
  var div = L.DomUtil.create("div", "leaflet-control-north");
  return div;
};
north.addTo(map);

</script>
